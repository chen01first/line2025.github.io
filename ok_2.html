<!DOCTYPE html>
<html lang="zh-TW">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>蔡老師數字DNA分析工具</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" />
</head>

<body class="bg-gray-100 text-gray-800">
  <div class="max-w-6xl mx-auto p-4 space-y-6">
    <!-- Header 區塊 -->
    <header class="text-center">
      <h1 class="text-3xl font-bold text-indigo-700">蔡老師數字DNA分析工具</h1>
      <p class="text-gray-600 mt-2">輸入號碼後的每一步分析結果</p>
    </header>

    <!-- Tabs 選單 -->
    <div class="bg-white p-6 rounded-lg shadow">
      <div class="tabs flex space-x-2 mb-4">
        <button class="tab-btn bg-indigo-100 text-indigo-700 font-semibold px-4 py-2 rounded">手機號碼DNA</button>
        <button class="tab-btn bg-gray-100 text-gray-600 font-semibold px-4 py-2 rounded">有圖有真相</button>
        <button class="tab-btn bg-gray-100 text-gray-600 font-semibold px-4 py-2 rounded">分享給更多人</button>
      </div>

      <!-- 分析表單區 -->
      <label for="phoneInput" class="block text-lg font-medium mb-2">輸入電話號碼：</label>
      <input type="text" id="phoneInput" placeholder="請輸入09開頭的電話號碼:共10位數字"
        class="w-full p-3 border border-gray-300 rounded-md mb-4 text-lg" />
      <button id="analyzeBtn"
        class="bg-indigo-600 text-white font-semibold py-2 px-4 rounded hover:bg-indigo-700 transition">
        開始分析
      </button>
    </div>

    <!-- 分析結果區 -->
    <section>
      <h2 class="text-xl font-semibold text-indigo-700 mt-6 mb-2">分析結果</h2>
      <div id="analysisOutput" class="space-y-4"></div>
    </section>

    <!-- 統計摘要區 -->
    <section>
      <h2 class="text-xl font-semibold text-indigo-700 mt-6 mb-2">主題統計</h2>
      <textarea id="summaryOutput" readonly
        class="w-full p-3 border border-gray-300 rounded-md text-base h-24"
        placeholder="統計摘要會顯示在這裡..."></textarea>
    </section>

    <!-- 手機號碼循環分析 -->
    <section>
      <h2 class="text-xl font-semibold text-indigo-700 mt-6 mb-2">手機號碼循環分析</h2>
      <div id="cycleAnalysis" class="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-10 gap-4"></div>
    </section>

    <!-- 延伸分析 -->
    <section>
      <h2 class="text-xl font-semibold text-indigo-700 mt-6 mb-2">伏位主題延伸分析</h2>
      <div id="extendAnalysis" class="grid grid-cols-4 sm:grid-cols-6 lg:grid-cols-10 gap-4"></div>
    </section>
  </div>

  <script>
    document.getElementById("analyzeBtn").addEventListener("click", () => {
      const number = document.getElementById("phoneInput").value.trim();
      if (number.length !== 10 || !/^\d+$/.test(number) || !number.startsWith("09")) {
        alert("請輸入09開頭的電話號碼:共10位數字");
        return;
      }

      const themes = {
        天醫: [13, 27, 49, 68, 31, 72, 94, 86],
        生氣: [14, 28, 39, 67, 41, 82, 93, 76],
        延年: [19, 26, 34, 78, 91, 62, 43, 87],
        伏位: [
          0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 11, 22, 33, 44, 66, 77, 88, 99, 10, 20, 30, 40,
          50, 60, 70, 80, 90, 51, 52, 53, 54, 55, 56, 57, 58, 59, 15, 25, 35,
          45, 65, 75, 85, 95,
        ],
        六煞: [16, 29, 38, 47, 61, 92, 83, 74],
        禍害: [17, 23, 46, 89, 71, 32, 64, 98],
        絶命: [12, 37, 48, 69, 21, 73, 84, 96],
        五鬼: [18, 24, 36, 79, 81, 42, 63, 97],
      };

      const stats = {};
      Object.keys(themes).forEach((key) => (stats[key] = 0));
      const results = [];

      for (let i = 0; i < number.length - 1; i++) {
        const segment = number.substring(i, i + 2);
        const value = parseInt(segment, 10);

        let found = "無符合";
        for (const [theme, values] of Object.entries(themes)) {
          if (values.includes(value)) {
            found = theme;
            stats[theme]++;
            break;
          }
        }

        results.push({
          step: i + 1,
          comment: `第${i + 1}步`,
          before: number.substring(0, i),
          highlight: segment,
          after: number.substring(i + 2),
          value,
          theme: found,
        });
      }

      // 最後一位 + 0
      const lastSegment = number[number.length - 1] + "0";
      const value = parseInt(lastSegment, 10);
      let found = "無符合";
      for (const [theme, values] of Object.entries(themes)) {
        if (values.includes(value)) {
          found = theme;
          stats[theme]++;
          break;
        }
      }
      results.push({ step: 10, comment: "第10步：往前循環接0", before: number.substring(0, 9), highlight: lastSegment, after: "", value, theme: found });

      // 分析結果區
      const container = document.getElementById("analysisOutput");
      container.innerHTML = "";
      const grid = document.createElement("div");
      grid.className = "grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4";
      container.appendChild(grid);

      results.forEach(({ step, comment, before, highlight, after, value, theme }) => {
        const div = document.createElement("div");
        div.className = "bg-indigo-50 p-4 rounded-md shadow-sm text-sm";
        div.innerHTML = `<p class='text-sm text-gray-500 mb-1'>${comment}</p>
                         <p><span class='tracking-widest'>${before}</span><span class='text-red-600 font-bold'>${highlight}</span><span class='tracking-widest'>${after}</span></p>
                         <p><strong class='text-gray-800'>${value.toString().padStart(2, '0')}</strong>：<span class='text-emerald-700 font-semibold'>${theme}</span></p>`;
        grid.appendChild(div);
      });

      // 統計摘要
      const summary = [];
      Object.entries(stats).forEach(([theme, count]) => {
        if (count > 0) summary.push(`${theme}：${count}次`);
      });
      document.getElementById("summaryOutput").value = summary.length ? summary.join("；") : "所有組別皆無符合主題";

      // 手機號碼循環分析
      const cycleOutput = document.getElementById("cycleAnalysis");
      cycleOutput.innerHTML = "";
      results.forEach((r, i) => {
        const div = document.createElement("div");
        div.className = "bg-white rounded shadow p-2 text-center";
        div.innerHTML = `<p class='font-bold text-indigo-600'>${i + 1}</p><p class='text-lg'>${r.highlight}</p><p>${r.theme}</p>`;
        cycleOutput.appendChild(div);
      });

      // 伏位主題延伸分析
      const extendOutput = document.getElementById("extendAnalysis");
      extendOutput.innerHTML = "";

      // 先定義我們要追蹤的主題群（排除伏位和無符合）
      const mainThemes = ["天醫", "生氣", "延年", "六煞", "禍害", "絶命", "五鬼"];

      let baseTheme = null; // 開始的主題（非伏位）
      let fuweiCount = 0;   // 伏位累計數

      for (let i = 0; i < results.length; i++) {
        const { highlight, theme, step } = results[i];
        if (theme === "伏位") {
          // 如果之前有 baseTheme，伏位累計並輸出
          if (baseTheme && fuweiCount < 9) {
            fuweiCount++;
            const div = document.createElement("div");
            div.className = "bg-white rounded shadow p-2 text-center";
            div.innerHTML = `<p class='font-bold text-indigo-600'>${step}</p><p class='text-lg'>${highlight}</p><p>伏位:${baseTheme}延伸</p>`;
            extendOutput.appendChild(div);
          } else {
            // 如果沒有baseTheme就單純輸出伏位（可選，這裡忽略）
            const div = document.createElement("div");
            div.className = "bg-white rounded shadow p-2 text-center";
            div.innerHTML = `<p class='font-bold text-indigo-600'>${step}</p><p class='text-lg'>${highlight}</p><p>伏位</p>`;
            extendOutput.appendChild(div);
          }
        } else if (mainThemes.includes(theme)) {
          // 遇到非伏位的主題，重置基底主題，重置伏位計數
          baseTheme = theme;
          fuweiCount = 0;
          const div = document.createElement("div");
          div.className = "bg-white rounded shadow p-2 text-center";
          div.innerHTML = `<p class='font-bold text-indigo-600'>${step}</p><p class='text-lg'>${highlight}</p><p>${theme}</p>`;
          extendOutput.appendChild(div);
        } else {
          // 無符合 或其他，重置 baseTheme 與計數
          baseTheme = null;
          fuweiCount = 0;
          const div = document.createElement("div");
          div.className = "bg-white rounded shadow p-2 text-center";
          div.innerHTML = `<p class='font-bold text-indigo-600'>${step}</p><p class='text-lg'>${highlight}</p><p>${theme}</p>`;
          extendOutput.appendChild(div);
        }
      }
    });
  </script>
</body>

</html>
