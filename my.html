<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éºç”¢ç¨…è¦åŠƒè©¦ç®—å·¥å…· (ä¿®æ­£å…¬å¼ç‰ˆ)</title>
    <style>
        :root {
            --header-blue: #004a99;
            --header-text: white;
            --bg-grey: #f2f2f2;
            --bg-yellow: #ffc003; /* ä½¿ç”¨æ‚¨æŒ‡å®šçš„é¡è‰² */
            --border-color: #cccccc;
            --highlight-red: #d9534f;
        }

        * { box-sizing: border-box; }
        body {
            font-family: "Microsoft JhengHei", sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #ededed;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        /* RWD ä½ˆå±€ */
        .grid-wrapper {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        @media (min-width: 992px) {
            .grid-wrapper { grid-template-columns: 5fr 5fr; }
        }

        .table-responsive { width: 100%; overflow-x: auto; margin-bottom: 20px; }
        table { width: 100%; border-collapse: collapse; min-width: 320px; }
        th, td { border: 1px solid var(--border-color); padding: 10px; text-align: center; }

        .header-blue { background-color: var(--header-blue); color: var(--header-text); font-weight: bold; }
        .bg-grey { background-color: var(--bg-grey); }
        .bg-yellow { background-color: var(--bg-yellow); font-weight: bold; }
        .text-right { text-align: right !important; }
        .text-red { color: var(--highlight-red); font-weight: bold; }
        .text-large { font-size: 1.3rem; font-weight: bold; }

        /* è¼¸å…¥æ¡†æ¨£å¼ - å·²ä¿®æ”¹åº•è‰²ç‚º #ffc003 */
        input[type="number"] { 
            padding: 8px; 
            border: 2px solid #333; /* åŠ æ·±é‚Šæ¡†è®“é»ƒè‰²æ›´é¡¯çœ¼ */
            border-radius: 4px; 
            text-align: right; 
            background-color: var(--bg-yellow); /* è¼¸å…¥æ¡†åº•è‰² */
            font-weight: bold;
            color: #000;
        }
        
        .input-large { width: 300px; max-width: 100%; font-size: 1.1rem; }
        .input-count { width: 70px; text-align: center; }

        .formula-note { font-size: 0.85rem; color: #666; margin-top: 10px; line-height: 1.6; padding: 10px; border-left: 5px solid var(--header-blue); background: #f9f9f9; }
    </style>
</head>
<body>

<div class="container">
    <div class="grid-wrapper">
        
        <div class="left-panel">
            <div class="table-responsive">
                <table>
                    <tr>
                        <th class="header-blue" width="30%">é è¨ˆ<br>æ·¨è³‡ç”¢</th>
                        <td class="bg-yellow text-right">
                            <input type="number" id="totalAssets" class="input-large" value="140000000"> å…ƒ
                        </td>
                    </tr>
                    <tr>
                        <th class="bg-grey">æ‰£é™¤å…ç¨…é¡<br>(å·²æ‰£é™¤)</th>
                        <td class="bg-grey text-large"><span id="displayTotalDeduction">2136</span> è¬</td>
                    </tr>
                    <tr>
                        <th class="bg-grey">éºç”¢ç¨…<br>(ç¨…ç‡ <span id="estateTaxRateDisplay">20%</span>)</th>
                        <td class="bg-grey text-large text-red"><span id="estateTaxResult">1623</span> è¬</td>
                    </tr>
                </table>
            </div>

            <div class="table-responsive">
                <table>
                    <tr>
                        <th class="header-blue" width="30%">é è¨ˆ<br>è¦åŠƒç¨…æº</th>
                        <td colspan="3" class="bg-yellow text-right">
                            <input type="number" id="planAmount" class="input-large" value="10000000"> å…ƒ
                        </td>
                    </tr>
                    <tr class="header-blue">
                        <th>è¦åŠƒé …ç›®</th>
                        <th>è´ˆèˆ‡</th>
                        <th>æœ‰è¦åŠƒ<br>(ç„¡åˆ—å…¥éºç”¢)</th>
                        <th>æœ‰è¦åŠƒ<br>(æœ‰åˆ—å…¥éºç”¢)</th>
                    </tr>
                    <tr>
                        <th class="bg-grey">ä¿éšœå€æ•¸</th>
                        <td>0</td>
                        <td class="bg-yellow">
                            <input type="number" id="insuranceMultiplier" class="input-count" value="2.3" step="0.1">
                        </td>
                        <td class="bg-grey"><span id="displayMultiplier">2.3</span></td>
                    </tr>
                    <tr>
                        <th class="bg-grey">ç¨…ç‡ /<br>æ‡‰ç´ç¨…é¡</th>
                        <td>è´ˆèˆ‡ç¨… 10%<br><span id="giftTaxResult">76è¬</span></td>
                        <td>-</td>
                        <td class="bg-grey">éºç”¢ç¨… <span id="planEstateTaxRate">20%</span><br><span id="planEstateTaxResult">460è¬</span></td>
                    </tr>
                    <tr>
                        <th class="bg-grey">æœ€å¾Œ<br>é ç•™é‡‘é¡</th>
                        <td class="text-large"><span id="giftFinalAmount">925è¬</span></td>
                        <td class="bg-grey text-large text-red"><span id="planNoEstateFinalAmount">2300è¬</span></td>
                        <td class="bg-grey text-large"><span id="planYesEstateFinalAmount">1840è¬</span></td>
                    </tr>
                </table>
            </div>
            <div class="formula-note">
                <strong>ğŸ’¡ å°ˆæ¥­è¦åŠƒèªªæ˜ï¼š</strong><br>
                1. æ‡‰ç´éºç”¢ç¨… = (æ·¨è³‡ç”¢ - æ‰£é™¤é¡) Ã— ç¨…ç‡ - ç´¯é€²å·®é¡<br>
                2. ä¿éšœè¦åŠƒç¨…é¡ = (è¦åŠƒé‡‘é¡ Ã— ä¿éšœå€æ•¸) Ã— éºç”¢ç¨…ç‡<br>
                3. æœ€å¾Œé ç•™é‡‘é¡ = (è¦åŠƒé‡‘é¡ Ã— ä¿éšœå€æ•¸) - æ‡‰ç´ç¨…é¡
            </div>
        </div>

        <div class="right-panel">
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr class="header-blue">
                            <th colspan="4">éºç”¢ç¨…æ‰£é™¤é¡äººæ•¸è¼¸å…¥</th>
                        </tr>
                        <tr class="bg-grey">
                            <th>é …ç›®</th>
                            <th>åŸºæº–(è¬)</th>
                            <th>äººæ•¸</th>
                            <th>å°è¨ˆ(è¬)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>éºç”¢å…ç¨…é¡</td><td>1333</td><td>åŸºæº–</td><td>1333</td></tr>
                        <tr>
                            <td>é…å¶æ‰£é™¤</td><td>553</td>
                            <td class="bg-yellow"><input type="number" id="countSpouse" class="input-count" value="1" min="0" max="1"></td>
                            <td><span id="subSpouse">553</span></td>
                        </tr>
                        <tr>
                            <td>ç›´ç³»å‘è¦ªå±¬</td><td>56</td>
                            <td class="bg-yellow"><input type="number" id="countChild" class="input-count" value="2" min="0"></td>
                            <td><span id="subChild">112</span></td>
                        </tr>
                        <tr>
                            <td>çˆ¶æ¯æ‰£é™¤</td><td>138</td>
                            <td class="bg-yellow"><input type="number" id="countParent" class="input-count" value="0" min="0" max="2"></td>
                            <td><span id="subParent">0</span></td>
                        </tr>
                        <tr><td>å–ªè‘¬è²»</td><td>138</td><td>åŸºæº–</td><td>138</td></tr>
                        <tr class="header-blue">
                            <td colspan="3" class="text-right">ç¸½è¨ˆæ‰£é™¤é¡(è¬)ï¼š</td>
                            <td class="text-large"><span id="totalDeductionCalc">2136</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-responsive">
                <table style="font-size: 0.85rem;">
                    <tr class="header-blue"><th colspan="4">ç´šè·åŸºæº–è¡¨ (115å¹´èµ·é©ç”¨)</th></tr>
                    <tr class="bg-grey"><td>ç¨…ç›®</td><td>ç´šè·</td><td>ç¨…ç‡</td><td>ç´¯é€²å·®é¡</td></tr>
                    <tr><td rowspan="3">éºç”¢ç¨…</td><td>5621è¬ä»¥ä¸‹</td><td>10%</td><td>0</td></tr>
                    <tr><td>è¶…é5621è¬~1å„„1242è¬</td><td>15%</td><td>281.05è¬</td></tr>
                    <tr><td>è¶…é1å„„1242è¬</td><td>20%</td><td>843.15è¬</td></tr>
                    <tr style="border-top: 2px solid #999;"><td rowspan="3">è´ˆèˆ‡ç¨…</td><td>2811è¬ä»¥ä¸‹</td><td>10%</td><td>0</td></tr>
                    <tr><td>2811è¬~5621è¬</td><td>15%</td><td>140.55è¬</td></tr>
                    <tr><td>è¶…é5621è¬</td><td>20%</td><td>421.575è¬</td></tr>
                </table>
            </div>
        </div>
    </div>
</div>

<script>
    // å®šç¾©æ³•è¦å¸¸æ•¸ (115å¹´æ–°åˆ¶)
    const D_BASE = 13330000, D_FUNERAL = 1380000, G_EXEMPT = 2440000;
    const D_SPOUSE = 5530000, D_CHILD = 560000, D_PARENT = 1380000;

    function toWan(num) { return Math.round(num / 10000); }

    function calculate() {
        const assets = parseFloat(document.getElementById('totalAssets').value) || 0;
        const planAmount = parseFloat(document.getElementById('planAmount').value) || 0;
        const multiplier = parseFloat(document.getElementById('insuranceMultiplier').value) || 0;
        
        const nS = parseInt(document.getElementById('countSpouse').value) || 0;
        const nC = parseInt(document.getElementById('countChild').value) || 0;
        const nP = parseInt(document.getElementById('countParent').value) || 0;

        // 1. æ‰£é™¤é¡è¨ˆç®—
        document.getElementById('subSpouse').innerText = toWan(nS * D_SPOUSE);
        document.getElementById('subChild').innerText = toWan(nC * D_CHILD);
        document.getElementById('subParent').innerText = toWan(nP * D_PARENT);

        const totalD = D_BASE + D_FUNERAL + (nS * D_SPOUSE) + (nC * D_CHILD) + (nP * D_PARENT);
        const totalDWan = toWan(totalD);
        document.getElementById('totalDeductionCalc').innerText = totalDWan;
        document.getElementById('displayTotalDeduction').innerText = totalDWan;

        // 2. éºç”¢ç¨…è¨ˆç®— (115å¹´æ–°ç´šè·)
        const netEstate = assets - totalD;
        let eRate = 0.1, eDiff = 0;
        // ä½¿ç”¨æ‚¨æœ€æ–°çš„ç´šè·æ•¸æ“š
        if (netEstate > 112420000) { eRate = 0.2; eDiff = 8431500; }
        else if (netEstate > 56210000) { eRate = 0.15; eDiff = 2810500; }
        
        const eTax = netEstate > 0 ? (netEstate * eRate - eDiff) : 0;
        document.getElementById('estateTaxRateDisplay').innerText = (eRate * 100) + '%';
        document.getElementById('estateTaxResult').innerText = toWan(eTax);

        // 3. è¦åŠƒé …ç›®è¨ˆç®—
        document.getElementById('displayMultiplier').innerText = multiplier;
        const leveragedVal = planAmount * multiplier;
        
        // è´ˆèˆ‡ç¨… (10% ç´šè·)
        const netGift = planAmount - G_EXEMPT;
        const gTax = netGift > 0 ? (netGift * 0.1) : 0;
        document.getElementById('giftTaxResult').innerText = toWan(gTax) + 'è¬';
        document.getElementById('giftFinalAmount').innerText = toWan(planAmount - gTax) + 'è¬';

        // æœ‰è¦åŠƒ(ç„¡åˆ—å…¥)
        document.getElementById('planNoEstateFinalAmount').innerText = toWan(leveragedVal) + 'è¬';

        // æœ‰è¦åŠƒ(åˆ—å…¥éºç”¢)
        const planEstateTax = leveragedVal * eRate; 
        document.getElementById('planEstateTaxRate').innerText = (eRate * 100) + '%';
        document.getElementById('planEstateTaxResult').innerText = toWan(planEstateTax) + 'è¬';
        document.getElementById('planYesEstateFinalAmount').innerText = toWan(leveragedVal - planEstateTax) + 'è¬';
    }

    // ç›£è½æ‰€æœ‰è¼¸å…¥æ¡†è®Šå‹•
    document.querySelectorAll('input').forEach(input => input.addEventListener('input', calculate));
    
    // åˆå§‹è¨ˆç®—
    calculate();
</script>

</body>
</html>