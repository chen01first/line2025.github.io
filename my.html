<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>遺產稅與贈與稅試算工具 - RWD 專業版</title>
    <style>
        :root {
            --header-blue: #004a99;
            --header-text: white;
            --bg-grey: #f2f2f2;
            --bg-yellow: #fff2cc;
            --border-color: #cccccc;
            --highlight-red: #d9534f;
            --dark-text: #333333;
        }

        * { box-sizing: border-box; }
        body {
            font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
            margin: 0;
            padding: 10px;
            background-color: #ededed;
            color: var(--dark-text);
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #ffffff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        h1 { text-align: center; color: var(--header-blue); font-size: 1.5rem; margin-bottom: 20px; }

        /* RWD Grid 佈局 */
        .grid-wrapper {
            display: grid;
            grid-template-columns: 1fr; /* 手機預設一欄 */
            gap: 25px;
        }

        @media (min-width: 992px) {
            .grid-wrapper {
                grid-template-columns: 1fr 1fr; /* 電腦端雙欄 */
            }
        }

        /* 表格響應式包裝器 */
        .table-responsive {
            width: 100%;
            overflow-x: auto;
            margin-bottom: 20px;
            -webkit-overflow-scrolling: touch;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 320px; /* 確保表格不會縮小到無法閱讀 */
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 12px 8px;
            text-align: center;
        }

        .header-blue { background-color: var(--header-blue); color: var(--header-text); font-weight: bold; }
        .bg-grey { background-color: var(--bg-grey); }
        .bg-yellow { background-color: var(--bg-yellow); font-weight: bold; }
        .text-right { text-align: right !important; }
        .text-red { color: var(--highlight-red); font-weight: bold; }
        .text-large { font-size: 1.3rem; font-weight: bold; }

        /* 輸入框樣式優化 */
        input[type="number"] {
            padding: 8px;
            border: 1px solid #aaa;
            border-radius: 4px;
            text-align: right;
            font-size: 1rem;
        }

        .input-large { 
            width: 300px; /* 依照要求拉長為2倍寬 */
            max-width: 100%; /* 手機端自動適應寬度 */
            color: var(--header-blue);
            background-color: #fff;
            border: 2px solid #aec6cf;
        }

        .input-count { width: 60px; text-align: center; }

        /* 級距表小字樣式 */
        .small-text { font-size: 0.85rem; color: #666; }
        .bracket-header { background-color: #444; color: white; font-weight: bold; font-size: 0.9rem; }
        
        .footer-note { font-size: 0.8rem; color: #888; text-align: center; margin-top: 20px; }

    </style>
</head>
<body>

<div class="container">
    <h1>106年新制遺產與贈與稅規劃計算機</h1>

    <div class="grid-wrapper">
        
        <div class="left-panel">
            <div class="table-responsive">
                <table>
                    <tr>
                        <th class="header-blue" width="30%">預計<br>淨資產</th>
                        <td class="bg-yellow text-right">
                            <input type="number" id="totalAssets" class="input-large" value="140000000"> 元
                        </td>
                    </tr>
                    <tr>
                        <th class="bg-grey">總扣除額<br>(含免稅額)</th>
                        <td class="bg-grey text-large"><span id="displayTotalDeduction">2136</span> 萬</td>
                    </tr>
                    <tr>
                        <th class="bg-grey">應納遺產稅<br>(稅率 <span id="estateTaxRateDisplay">20%</span>)</th>
                        <td class="bg-grey text-large text-red"><span id="estateTaxResult">1623</span> 萬</td>
                    </tr>
                </table>
            </div>

            <div class="table-responsive">
                <table>
                    <tr>
                        <th class="header-blue" width="30%">預計<br>規劃稅源</th>
                        <td colspan="3" class="bg-yellow text-right">
                            <input type="number" id="planAmount" class="input-large" value="10000000"> 元
                        </td>
                    </tr>
                    <tr class="header-blue">
                        <th>規劃項目</th>
                        <th>贈與稅</th>
                        <th>有規劃<br>(不列入遺產)</th>
                        <th>有規劃<br>(列入遺產)</th>
                    </tr>
                    <tr>
                        <th class="bg-grey">保障倍數</th>
                        <td>0</td>
                        <td class="bg-yellow text-red">
                            <input type="number" id="insuranceMultiplier" class="input-count" value="2.3" step="0.1">
                        </td>
                        <td class="bg-grey"><span id="displayMultiplier">2.3</span></td>
                    </tr>
                    <tr>
                        <th class="bg-grey">稅率 /<br>稅額</th>
                        <td>贈與 10%<br><span id="giftTaxResult">76萬</span></td>
                        <td>-</td>
                        <td class="bg-grey">遺產 <span id="planEstateTaxRate">20%</span><br><span id="planEstateTaxResult">460萬</span></td>
                    </tr>
                    <tr>
                        <th class="bg-grey">最後預留<br>資產價值</th>
                        <td class="text-large"><span id="giftFinalAmount">925萬</span></td>
                        <td class="bg-grey text-large text-red"><span id="planNoEstateFinalAmount">2300萬</span></td>
                        <td class="bg-grey text-large"><span id="planYesEstateFinalAmount">1840萬</span></td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="right-panel">
            <div class="table-responsive">
                <table>
                    <thead>
                        <tr class="header-blue">
                            <th colspan="4">遺產稅扣除額與人數輸入</th>
                        </tr>
                        <tr class="bg-grey">
                            <th>項目</th>
                            <th>基準(萬)</th>
                            <th>人數</th>
                            <th>小計(萬)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td>遺產免稅額</td><td>1333</td><td>基準</td><td>1333</td></tr>
                        <tr>
                            <td>配偶扣除</td><td>553</td>
                            <td class="bg-yellow"><input type="number" id="countSpouse" class="input-count" value="1" min="0" max="1"></td>
                            <td><span id="subSpouse">553</span></td>
                        </tr>
                        <tr>
                            <td>直系卑親屬</td><td>56</td>
                            <td class="bg-yellow"><input type="number" id="countChild" class="input-count" value="2" min="0"></td>
                            <td><span id="subChild">112</span></td>
                        </tr>
                        <tr>
                            <td>父母扣除</td><td>138</td>
                            <td class="bg-yellow"><input type="number" id="countParent" class="input-count" value="0" min="0" max="2"></td>
                            <td><span id="subParent">0</span></td>
                        </tr>
                        <tr><td>喪葬費</td><td>138</td><td>基準</td><td>138</td></tr>
                        <tr class="header-blue">
                            <td colspan="3" class="text-right">總計扣除額(萬)：</td>
                            <td class="text-large"><span id="totalDeductionCalc">2136</span></td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="table-responsive">
                <table>
                    <thead>
                        <tr class="bracket-header">
                            <th colspan="4">課稅級距對照表 (106年5月12日起適用)</th>
                        </tr>
                        <tr class="bg-grey">
                            <th>稅目</th>
                            <th>課稅級距</th>
                            <th>稅率</th>
                            <th>累進差額</th>
                        </tr>
                    </thead>
                    <tbody class="small-text">
                        <tr>
                            <td rowspan="3">遺產稅</td>
                            <td class="text-right">5,000 萬元以下</td><td>10%</td><td>0</td>
                        </tr>
                        <tr>
                            <td class="text-right">超過 5,000 萬 ~ 1 億元</td><td>15%</td><td>250 萬</td>
                        </tr>
                        <tr>
                            <td class="text-right">超過 1 億元</td><td>20%</td><td>750 萬</td>
                        </tr>
                        <tr style="border-top: 2px solid #888;">
                            <td rowspan="3">贈與稅</td>
                            <td class="text-right">2,500 萬元以下</td><td>10%</td><td>0</td>
                        </tr>
                        <tr>
                            <td class="text-right">超過 2,500 萬 ~ 5,000 萬元</td><td>15%</td><td>125 萬</td>
                        </tr>
                        <tr>
                            <td class="text-right">超過 5,000 萬元</td><td>20%</td><td>375 萬</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="footer-note">
        資料來源：財政部國稅局 106 年新制公告。請注意 115 年起免稅額可能隨物價指數微調。
    </div>
</div>

<script>
    // 常數設定 (106年新制)
    const BASE_EXEMPTION = 13330000;
    const BASE_FUNERAL = 1380000;
    const GIFT_EXEMPTION = 2440000;
    const D_SPOUSE = 5530000;
    const D_CHILD = 560000;
    const D_PARENT = 1380000;

    function toWan(num) { return Math.round(num / 10000); }

    function calculate() {
        // 取得輸入值
        const assets = parseFloat(document.getElementById('totalAssets').value) || 0;
        const planVal = parseFloat(document.getElementById('planAmount').value) || 0;
        const multiplier = parseFloat(document.getElementById('insuranceMultiplier').value) || 0;
        
        const nSpouse = parseInt(document.getElementById('countSpouse').value) || 0;
        const nChild = parseInt(document.getElementById('countChild').value) || 0;
        const nParent = parseInt(document.getElementById('countParent').value) || 0;

        // 1. 計算扣除額
        const subS = nSpouse * D_SPOUSE;
        const subC = nChild * D_CHILD;
        const subP = nParent * D_PARENT;
        
        document.getElementById('subSpouse').innerText = toWan(subS);
        document.getElementById('subChild').innerText = toWan(subC);
        document.getElementById('subParent').innerText = toWan(subP);

        const totalD = BASE_EXEMPTION + BASE_FUNERAL + subS + subC + subP;
        const totalDWan = toWan(totalD);
        
        document.getElementById('totalDeductionCalc').innerText = totalDWan;
        document.getElementById('displayTotalDeduction').innerText = totalDWan;
        document.getElementById('planEstateExemption').innerText = totalDWan;

        // 2. 遺產稅計算 (10%, 15%, 20% 三段)
        const netEstate = assets - totalD;
        let eRate = 0.1, eDiff = 0;
        if (netEstate > 100000000) { eRate = 0.2; eDiff = 7500000; }
        else if (netEstate > 50000000) { eRate = 0.15; eDiff = 2500000; }
        
        const eTax = netEstate > 0 ? (netEstate * eRate - eDiff) : 0;
        document.getElementById('estateTaxRateDisplay').innerText = (eRate * 100) + '%';
        document.getElementById('estateTaxResult').innerText = toWan(eTax);

        // 3. 贈與稅與規劃試算
        document.getElementById('displayMultiplier').innerText = multiplier;
        const totalPlanValue = planVal * multiplier;
        
        const netGift = planVal - GIFT_EXEMPTION;
        let gRate = 0.1, gDiff = 0;
        if (netGift > 50000000) { gRate = 0.2; gDiff = 3750000; }
        else if (netGift > 25000000) { gRate = 0.15; gDiff = 1250000; }
        
        const gTax = netGift > 0 ? (netGift * gRate - gDiff) : 0;
        document.getElementById('giftTaxResult').innerText = toWan(gTax) + '萬';
        document.getElementById('giftFinalAmount').innerText = toWan(planVal - gTax) + '萬';

        // 規劃結果 (有/無遺產列入)
        document.getElementById('planNoEstateFinalAmount').innerText = toWan(totalPlanValue) + '萬';
        
        const planEstateTax = totalPlanValue * eRate; // 依圖片邏輯，資產放大後適用該案之遺產邊際稅率
        document.getElementById('planEstateTaxRate').innerText = (eRate * 100) + '%';
        document.getElementById('planEstateTaxResult').innerText = toWan(planEstateTax) + '萬';
        document.getElementById('planYesEstateFinalAmount').innerText = toWan(totalPlanValue - planEstateTax) + '萬';
    }

    // 監聽所有輸入框變動
    document.querySelectorAll('input').forEach(input => {
        input.addEventListener('input', calculate);
    });

    // 初始化計算
    calculate();
</script>

</body>
</html>