<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>蔡老師數字DNA分析工具 - 簡化測試</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body class="bg-gray-100 text-gray-800">
    <div class="max-w-5xl mx-auto p-4 space-y-6">
        <header class="text-center">
            <h1 class="text-3xl font-bold text-indigo-700">蔡老師數字DNA分析工具 - 簡化測試</h1>
            <p class="text-gray-600 mt-2">僅測試前後端連線</p>
        </header>

        <div class="bg-white p-6 rounded-lg shadow">
            <div class="input-section space-y-4">
                <h2 class="text-xl font-semibold text-indigo-700"><i class="fas fa-mobile-alt"></i> 手機號碼回傳測試</h2>
                <div class="form-group">
                    <label for="phone-number" class="block text-sm font-medium text-gray-700">輸入任意數字：</label>
                    <input type="text" id="phone-number" placeholder="請輸入數字"
                        class="mt-1 w-full border border-gray-300 rounded px-3 py-2">
                </div>
                <div class="button-group flex space-x-2">
                    <button id="analyze-phone-btn"
                        class="btn bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded">測試回傳</button>
                    <button id="reset-phone-btn"
                        class="btn bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded">清除</button>
                </div>
            </div>
        </div>

        <section id="analysis-summary" class="bg-white p-6 rounded-lg shadow hidden">
            <h2 class="text-xl font-semibold text-indigo-700 mb-3">🔍 回傳結果</h2>
            <p class="text-gray-700" id="summary-text"></p>
        </section>
    </div>

    <script>
        // 請務必將此 URL 替換為您新部署 Apps Script 後取得的 URL
        const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbw8JPBITpT51tmxrAcLP2tlLiXXnRi3NMs0qJldtctuw8ANY3f0SAMSr5bd9M8tuDxW/exec'; // 替換為您的新 URL

        document.getElementById('analyze-phone-btn').addEventListener('click', analyzePhoneNumber);
        document.getElementById('reset-phone-btn').addEventListener('click', resetAnalysis);

        function resetAnalysis() {
            document.getElementById('phone-number').value = '';
            document.getElementById('analysis-summary').classList.add('hidden');
            document.getElementById('summary-text').innerHTML = '';
        }

        async function analyzePhoneNumber() {
    const phoneNumber = document.getElementById('phone-number').value.trim();

    if (!phoneNumber) {
        alert('請輸入數字進行測試！');
        return;
    }

    document.getElementById('summary-text').innerHTML = '傳送中...';
    document.getElementById('analysis-summary').classList.remove('hidden');

    try {
        // !!! 請仔細檢查這一行 !!!
        // 確保 `APPS_SCRIPT_WEB_APP_URL` 和 `phoneNumber` 是在反引號 (`) 內的 `${}` 中
        // 並且沒有任何多餘的引號或其他字符
        //const response = await fetch(`${APPS_SCRIPT_WEB_APP_URL}?phoneNumber=${phoneNumber}`); 
        const response = await fetch(`<span class="math-inline">\{APPS\_SCRIPT\_WEB\_APP\_URL\}?phoneNumber\=</span>{phoneNumber}`);


        if (!response.ok) {
            // 對於 CORS 錯誤，status 可能會是 0 或不確定，但 response.ok 會是 false
            throw new Error(`HTTP error! status: ${response.status} or CORS issue.`);
        }
        
        // 嘗試解析 JSON 響應
        const data = await response.json(); 

        // 檢查後端回傳的 receivedNumber
        if (data && data.receivedNumber) {
            document.getElementById('summary-text').innerHTML = `從後端收到的數字是：<span class="font-bold text-indigo-900">${data.receivedNumber}</span>`;
        } else {
            // 如果回傳的 JSON 格式不是預期的，也顯示出來
            document.getElementById('summary-text').innerHTML = `後端回傳格式不符，請檢查！<pre>${JSON.stringify(data, null, 2)}</pre>`;
        }

    } catch (error) {
        console.error('Error fetching data from GS:', error);
        alert('連接後端發生錯誤，請檢查瀏覽器控制台。詳細錯誤：' + error.message);
        
        resetAnalysis();
    }
    }   
    </script>
</body>

</html>