<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apps Script Fetch Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        #response {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ccc;
            background-color: #f9f9f9;
            white-space: pre-wrap; /* 保持換行和空格 */
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            cursor: pointer;
            margin-right: 10px;
        }
        input[type="text"] {
            padding: 8px;
            font-size: 16px;
            width: 200px;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <h1>Google Apps Script Fetch 測試</h1>

    <p>
        此頁面將使用 `fetch` API 向 Google Apps Script Web App 發送請求並顯示回傳的資料。
    </p>

    <label for="nameInput">輸入您的名字 (用於 GET 請求):</label>
    <input type="text" id="nameInput" value="TestUser">
    <button id="fetchGetBtn">發送 GET 請求</button>
    <button id="fetchPostBtn">發送 POST 請求</button>

    <h2>伺服器回應:</h2>
    <pre id="response">等待回應...</pre>

    <script>
        // 將此 URL 替換為您部署的 Google Apps Script Web App URL
        const APPS_SCRIPT_WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbxtjdoieuq1iVjonuzmNXj-2pGHvLPgpYa7TSY7fCU1SrugKD26db9ph1Qo0hgEtN9s/exec'; // <-- 重要：請替換為您的實際 URL

        const responseDiv = document.getElementById('response');
        const nameInput = document.getElementById('nameInput');
        const fetchGetBtn = document.getElementById('fetchGetBtn');
        const fetchPostBtn = document.getElementById('fetchPostBtn');

        // 處理 GET 請求
        fetchGetBtn.addEventListener('click', async () => {
            const name = nameInput.value;
            // 將查詢參數添加到 URL
            const urlWithParams = `${APPS_SCRIPT_WEB_APP_URL}?name=${encodeURIComponent(name)}`;

            responseDiv.textContent = '正在發送 GET 請求...';
            try {
                const response = await fetch(urlWithParams);
                if (!response.ok) {
                    throw new Error(`HTTP 錯誤! 狀態碼: ${response.status}`);
                }
                const data = await response.json();
                responseDiv.textContent = 'GET 請求成功！\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                responseDiv.textContent = 'GET 請求失敗: ' + error.message;
                console.error('GET 請求錯誤:', error);
            }
        });

        // 處理 POST 請求
        fetchPostBtn.addEventListener('click', async () => {
            const name = nameInput.value;
            const postData = {
                name: name,
                client: 'HTML Fetch Example',
                timestamp: new Date().toISOString()
            };

            responseDiv.textContent = '正在發送 POST 請求...';
            try {
                const response = await fetch(APPS_SCRIPT_WEB_APP_URL, {
                    method: 'POST', // 指定為 POST 請求
                    headers: {
                        'Content-Type': 'application/json' // 告知伺服器發送的是 JSON 資料
                    },
                    body: JSON.stringify(postData) // 將 JavaScript 物件轉換為 JSON 字串
                });

                if (!response.ok) {
                    throw new Error(`HTTP 錯誤! 狀態碼: ${response.status}`);
                }
                const data = await response.json();
                responseDiv.textContent = 'POST 請求成功！\n' + JSON.stringify(data, null, 2);
            } catch (error) {
                responseDiv.textContent = 'POST 請求失敗: ' + error.message;
                console.error('POST 請求錯誤:', error);
            }
        });
    </script>
</body>
</html>